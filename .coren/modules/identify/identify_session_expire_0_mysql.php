<?php defined('CORENINPAGE') or die('Hack!');
####################################################################################################
####################################################################################################
####################################################################################################
#
class identify_session_expire_0_mysql extends coren_broker
{
#
####################################################################################################
####################################################################################################
####################################################################################################
#
function expire_sessions ($data)
{
	$db = coren::db('handle');
	$table_session = 'auth_session';

	$sql =
	"
		update {$table_session}
		   set `status` = 1, `closed` = now()
		 where `status` = 0 and `period` > 0
		   and (`touched` + interval `period` second) <= now()
	";
	$res = @mysql_query($sql, $db);
	if ($res === false) throw new exception(mysql_error($db), mysql_errno($db));
}
#
####################################################################################################
####################################################################################################
####################################################################################################
}
?>